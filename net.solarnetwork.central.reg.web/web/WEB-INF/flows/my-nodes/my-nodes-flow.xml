<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">
	
	<secured attributes="ROLE_USER" />
	
	<on-start>
		<evaluate expression="userBiz.getUser(currentUser.principal.userId)" result="flowScope.user"/>
	</on-start>
	
	<view-state id="start" view="my-nodes/start">
		<on-entry>
			<evaluate expression="userBiz.getUserNodes(user)" result="flowScope.userNodesList"/>
			<evaluate expression="userBiz.getPendingUserNodeConfirmations(user)" result="flowScope.pendingUserNodeConfirmationsList"/>
		</on-entry>
		<transition on="inviteNode" to="invite-node">
			<evaluate expression="registrationBiz.createNodeAssociation(user)" 
				result="flowScope.nodeAssociation"/>
		</transition>
	</view-state>
	
	<view-state id="invite-node" view="my-nodes/invite-node">
		<transition on="done" to="start"/>
	</view-state>

	<end-state id="done" view="my-nodes/start" />
	
</flow>
